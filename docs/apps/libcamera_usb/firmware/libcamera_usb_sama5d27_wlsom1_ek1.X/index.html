<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="http://localhost:4000/vision/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="http://localhost:4000/vision/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="http://localhost:4000/vision/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="http://localhost:4000/vision/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Microchip MPLAB Harmony Vision help | Harmony 3 Vision package</title> <meta name="generator" content="Jekyll v3.9.3" /> <meta property="og:title" content="Microchip MPLAB Harmony Vision help" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 Vision package" /> <meta property="og:description" content="Harmony 3 Vision package" /> <link rel="canonical" href="http://localhost:4000/vision/apps/libcamera_usb/firmware/libcamera_usb_sama5d27_wlsom1_ek1.X/" /> <meta property="og:url" content="http://localhost:4000/vision/apps/libcamera_usb/firmware/libcamera_usb_sama5d27_wlsom1_ek1.X/" /> <meta property="og:site_name" content="Microchip MPLAB Harmony Vision help" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Microchip MPLAB Harmony Vision help" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"Harmony 3 Vision package","headline":"Microchip MPLAB Harmony Vision help","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/vision/assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"http://localhost:4000/vision/apps/libcamera_usb/firmware/libcamera_usb_sama5d27_wlsom1_ek1.X/"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/vision/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/vision/" class="nav-list-link">Harmony 3 Vision Package</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/vision/apps/readme.html" class="nav-list-link">Vision Example Applications</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/vision/apps/libcamera_display/readme.html" class="nav-list-link">Libcamera Display</a></li><li class="nav-list-item "><a href="http://localhost:4000/vision/apps/libcamera_usb/readme.html" class="nav-list-link">Libcamera USB</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/vision/release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="http://localhost:4000/vision/mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony Vision help" aria-label="Search Microchip MPLAB Harmony Vision help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <p><img src="/vision/images/mh.png" alt="" /></p> <p>libcamera_usb_sama5d27_wlsom1_ek1.X</p> <h2 id="defining-the-architecture"> <a href="#defining-the-architecture" aria-labelledby="defining-the-architecture" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Defining the Architecture </h2> <p><img src="/vision/images/achitecture_diagrams_vision_sama5d2_wlsom1_ek1_usb.jpg" alt="" /></p> <p>This application demonstrates the use of ISC and USB peripherals. The camera module used in this application is ov5640 or ov2640 and USB Mass storage drive. This application capture JPEG video frame from ov5640 or raw VGA reolution from ov2640 camera module using parallel interface and captured frame is saved to a jpeg or bmp file and copied to USB drive using SAMA5D27-WLSOM1-EK1 target board.</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Hardware components</th> <th style="text-align: left">Images</th> <th style="text-align: left">Details</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">Development Board</td> <td style="text-align: left"><img src="/vision/images/sama5d27_wlsom1_ek1.jpg" alt="" /></td> <td style="text-align: left"><a href="https://www.microchip.com/en-us/development-tool/dm320117">SAMA5D27-WLSOM1-EK1</a></td> </tr> <tr> <td style="text-align: left">Camera Module</td> <td style="text-align: left"><img src="/vision/images/ov2640.jpg" alt="" /> <img src="/vision/images/ov5640.jpg" alt="" /></td> <td style="text-align: left"><a href="https://www.waveshare.com/ov2640-camera-board.htm">ov2640 image sensor</a> <a href="https://www.waveshare.com/ov5640-camera-board-a.htm"> or Ov5640 image sensor</a></td> </tr> </tbody> </table></div> <h3 id="demonstration-features"> <a href="#demonstration-features" aria-labelledby="demonstration-features" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Demonstration Features </h3> <ul> <li>Reference application for the SAMA5D27-WLSOM1-EK1 development Board</li> <li>Image Sensor Controller (ISC) driver</li> <li>Time system service, RTT/TC0 peripheral library and driver</li> <li>USB host implementation</li> <li>Filesystem implementation</li> <li>Analog push button handling</li> <li>I2C and Image sensor driver</li> </ul> <h2 id="creating-the-project-graph"> <a href="#creating-the-project-graph" aria-labelledby="creating-the-project-graph" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating the Project Graph </h2> <p><img src="/vision/images/isc_sama5d27_wlsom1_ek1_usb.jpg" alt="" /></p> <p>The Project Graph diagram shows the Harmony components that are included in this application. Lines between components are drawn to satisfy components that depend on a capability that another component provides.</p> <p>The I2C driver in this project is used for communication with the image sensor.</p> <p>The pins are configured as follows through the MCC Pin Configuration tool:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Pin ID</th> <th style="text-align: left">Custom Name</th> <th style="text-align: left">Function</th> <th style="text-align: left">Direction</th> <th style="text-align: left">Latch</th> <th style="text-align: left">Open Drain</th> <th style="text-align: left">PIO Interrupt</th> <th style="text-align: left">Pull Up</th> <th style="text-align: left">Pull Down</th> <th style="text-align: left">Glitch/Debounce Filter</th> <th style="text-align: left">Drive Strength</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">PA6</td> <td style="text-align: left">LED_RED</td> <td style="text-align: left">LED_AH</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PA7</td> <td style="text-align: left">LED_GREEN</td> <td style="text-align: left">LED_AH</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PA8</td> <td style="text-align: left">LED_BLUE</td> <td style="text-align: left">LED_AH</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PA9</td> <td style="text-align: left">CAMERA_RESET</td> <td style="text-align: left">GPIO</td> <td style="text-align: left">Out</td> <td style="text-align: left">High</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PA10</td> <td style="text-align: left">VBUS_AH</td> <td style="text-align: left">VBUS_AH</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PB2</td> <td style="text-align: left">USER_BUTTON</td> <td style="text-align: left">GPIO</td> <td style="text-align: left">In</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Falling Edge</td> <td style="text-align: left">Yes</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PB26</td> <td style="text-align: left"> </td> <td style="text-align: left">UART0_URXD0</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PB27</td> <td style="text-align: left"> </td> <td style="text-align: left">UART0_UTXD0</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC7</td> <td style="text-align: left">CAMERA_PWD</td> <td style="text-align: left">GPIO</td> <td style="text-align: left">Out</td> <td style="text-align: left">High</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC13</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D4</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC14</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D5</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC15</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D6</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC16</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D7</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC17</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D8</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC18</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D9</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC19</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D10</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC20</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_D11</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC21</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_PCK</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC22</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_VSYNC</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC23</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_HSYNC</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PC24</td> <td style="text-align: left"> </td> <td style="text-align: left">ISC_MCK</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PD19</td> <td style="text-align: left"> </td> <td style="text-align: left">TWIHS1_TWD1</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> <tr> <td style="text-align: left">PD20</td> <td style="text-align: left"> </td> <td style="text-align: left">TWIHS1_TWCK1</td> <td style="text-align: left">n/a</td> <td style="text-align: left">n/a</td> <td style="text-align: left">No</td> <td style="text-align: left">Disabled</td> <td style="text-align: left">No</td> <td style="text-align: left">No</td> <td style="text-align: left">Glitch Filter</td> <td style="text-align: left">0x0</td> </tr> </tbody> </table></div> <h2 id="clock-configuration"> <a href="#clock-configuration" aria-labelledby="clock-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clock Configuration </h2> <p>The peripheral clocks need to be turned on for “UART0” “TWIHS1”, “MPDDRC” “ISC”, “PIO” and “TC0”.</p> <p>The ISC clock need to be Enabled and USB HOST OHCI Clock should be enabled with USB OHCI Input source clock selected to UPLL_CLK and Divider for USB OHCI is set to 10.</p> <h2 id="interrupts-configuration"> <a href="#interrupts-configuration" aria-labelledby="interrupts-configuration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interrupts Configuration </h2> <p>The interrupts should be enabled in the “Interrupt for</p> <ul> <li>Enable 30 – Two Wire Interface 1</li> <li>Enable 35 – TC(0, 1, 2)</li> <li>Enable 41 – USB High Speed</li> <li>Enable 46 – Camera Inerface</li> <li>Enable 68 – Parallel IO Controller</li> </ul> <p><b>Note: The ov2640 or ov5640 image sensor is an off-the-shelf module and is not officially supported by MPLAB Harmony 3. While a driver for this module is included as part of this demo, it is not guaranteed to be complete. Nor are the ov2640 or ov5640 configuration values guaranteed to be optimal. The primary purpose of this application is to demonstrate the functionality of the Image Sensor Controller (ISC) on the SSAMA5D27-WLSOM1-EK1 board. </b></p> <h2 id="project-configurations"> <a href="#project-configurations" aria-labelledby="project-configurations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Configurations </h2> <p>MPU32”s do not have an internal flash memory to boot from. Hence the boot process for these mpu’s is different than for flash based MCUs. The boot process is described in detail in the device datasheets, but the general flow is as follows:</p> <ol> <li>On power-up the device executes the first stage bootloader from internal ROM. This looks for an second stage bootloader on external non-volatile memory such as eMMC, SD, NAND flash, NOR-SPI and QSPI as second stage boot devices. For SD and eMMC, ROM bootloader expects a file named “boot.bin” to reside in the root directory of a FAT file system.</li> <li>The second stage bootloader is copied to on-chip SRAM and executed. The second stage boot loader initialize the external DRAM and its controller, then load other program from external non-volatile memory into DRAM and execute it. The second stage bootloader must be configured for the board in use and for the external NVM containing the application. A comprehensive description of the boot process for the Microchip MPU’s can be found in this application note: https://ww1.microchip.com/downloads/en/AppNotes/AN2791-Booting-from-External-Non-Volatile-Memory-on-SAMA5D2-MPU-Application-Note-DS00002791A.pdf</li> <li>The vision application is linked to run/debug on the external DRAM. During a debug process, MPLAB X will first run (load) the at91bootstrap program and this file can be found in the <project>.X folder whose function is to initialize the chip, its clocks, debug port to view log messages and initialize the external DRAM.</project></li> </ol> <p>Below are Project configuration steps to Debug or Run Vision application. On the MPLAB X IDE, right click on the project and click “Properties”.</p> <ol> <li>In “Connected Hardware Tool”, select JLink or J-Tag, and in “Compiler Toolchain”, select XC32 and click apply.</li> <li>Under Categories, click on “Bootstrap”, ensure that “Use bootstrap” is checked and the path to the bootstrap.elf file is set.</li> <li>The harmony.bin should be generated as a post-build command. Under Categories, click on “Building”, ensure that “Execute this line after build” is checked and set “${MP_CC_DIR}/xc32-objcopy -O binary ${DISTDIR}\/${PROJECTNAME}.${IMAGE_TYPE}.elf ${DISTDIR}\/harmony.bin”</li> </ol> <h2 id="building-the-application"> <a href="#building-the-application" aria-labelledby="building-the-application" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Building the Application </h2> <p>The parent directory for this application is in vision/apps/ibcamera_usb. To build this application, use MPLAB X IDE to open the vision/apps/libcamera_usb/firmware/libcamera_usb_sama5d27_wlsom1_ek1.X project and press F11.</p> <p>If the build is successfull, then a harmony.bin file is generate in vision/apps/libcamera_usb/firmware/libcamera_usb_sama5d27_wlsom1_ek1.X/dist/isc_sama5d27_wlsom1_ek1_usb_msd/production folder.</p> <p>The following table lists configuration properties:</p> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: left">Project Name</th> <th style="text-align: left">BSP Used</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">libcamera_usb_sama5d27_wlsom1_ek1.X</td> <td style="text-align: left"><a href="https://www.microchip.com/en-us/development-tool/dm320117">SAMA5D27-WLSOM1-EK1</a></td> <td style="text-align: left"><a href="https://www.microchip.com/en-us/development-tool/dm320117">SAMA5D27-WLSOM1-EK1</a> using the parallel interface to capture video frames from the <a href="https://www.waveshare.com/ov2640-camera-board.htm">ov2640 image sensor</a> <a href="https://www.waveshare.com/ov5640-camera-board-a.htm"> or Ov5640 image sensor</a> and captured frame is saved to a bmp file and copied to USB drive.</td> </tr> </tbody> </table></div> <h2 id="prebuilt-binaries"> <a href="#prebuilt-binaries" aria-labelledby="prebuilt-binaries" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prebuilt binaries </h2> <p>Latest release prebuilt binaries are available for a <a href="https://www.microchip.com/en-us/development-tool/dm320117">SAMA5D27-WLSOM1-EK1</a> board is <a href="https://microchiptechnology-my.sharepoint.com/:u:/g/personal/sandeepsheriker_mallikarjun_microchip_com/EcJ6DBSSAV5BqYN_y8RnnLkBS07Tc_eK74mSJBuO9xJdNQ?e=7DNwKQ">here</a></p> <h2 id="configuring-the-hardware"> <a href="#configuring-the-hardware" aria-labelledby="configuring-the-hardware" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring the Hardware </h2> <p>Configure the hardware as follows:</p> <ul> <li>The OV5640 or OV2640 camera module is wired to the ISC header (J18) on the SAMA5D27-WLSOM1-EK1 board using the following wiring diagram:</li> </ul> <div class="table-wrapper"><table> <thead> <tr> <th style="text-align: center">Module Function</th> <th style="text-align: center">Camera Module Pin</th> <th style="text-align: center">ISC Pin</th> <th style="text-align: center">ISC Function</th> </tr> </thead> <tbody> <tr> <td style="text-align: center">VCC</td> <td style="text-align: center">1</td> <td style="text-align: center">1</td> <td style="text-align: center">3.3 VCC</td> </tr> <tr> <td style="text-align: center">GND</td> <td style="text-align: center">2</td> <td style="text-align: center">2</td> <td style="text-align: center">GND</td> </tr> <tr> <td style="text-align: center">SCL</td> <td style="text-align: center">3</td> <td style="text-align: center">7 (PD20)</td> <td style="text-align: center">TWI Clock</td> </tr> <tr> <td style="text-align: center">SDA</td> <td style="text-align: center">4</td> <td style="text-align: center">8 (PD19)</td> <td style="text-align: center">TWI Data</td> </tr> <tr> <td style="text-align: center">VSYNC</td> <td style="text-align: center">5</td> <td style="text-align: center">12 (PC22)</td> <td style="text-align: center">VSYNC</td> </tr> <tr> <td style="text-align: center">HREF</td> <td style="text-align: center">6</td> <td style="text-align: center">14 (PC23)</td> <td style="text-align: center">HSYNC</td> </tr> <tr> <td style="text-align: center">PCLK</td> <td style="text-align: center">7</td> <td style="text-align: center">16 (PC21)</td> <td style="text-align: center">PCLK</td> </tr> <tr> <td style="text-align: center">XCLK</td> <td style="text-align: center">8</td> <td style="text-align: center">10 (PC24)</td> <td style="text-align: center">MCLK</td> </tr> <tr> <td style="text-align: center">DOUT9</td> <td style="text-align: center">9</td> <td style="text-align: center">25 (PC20)</td> <td style="text-align: center">D11</td> </tr> <tr> <td style="text-align: center">DOUT8</td> <td style="text-align: center">10</td> <td style="text-align: center">24 (PC19)</td> <td style="text-align: center">D10</td> </tr> <tr> <td style="text-align: center">DOUT7</td> <td style="text-align: center">11</td> <td style="text-align: center">23 (PC18)</td> <td style="text-align: center">D09</td> </tr> <tr> <td style="text-align: center">DOUT6</td> <td style="text-align: center">12</td> <td style="text-align: center">22 (PC17)</td> <td style="text-align: center">D08</td> </tr> <tr> <td style="text-align: center">DOUT5</td> <td style="text-align: center">13</td> <td style="text-align: center">21 (PC16)</td> <td style="text-align: center">D07</td> </tr> <tr> <td style="text-align: center">DOUT4</td> <td style="text-align: center">14</td> <td style="text-align: center">20 (PC15)</td> <td style="text-align: center">D06</td> </tr> <tr> <td style="text-align: center">DOUT3</td> <td style="text-align: center">15</td> <td style="text-align: center">19 (PC14)</td> <td style="text-align: center">D05</td> </tr> <tr> <td style="text-align: center">DOUT2</td> <td style="text-align: center">16</td> <td style="text-align: center">18 (PC13)</td> <td style="text-align: center">D04</td> </tr> <tr> <td style="text-align: center">DOUT1</td> <td style="text-align: center">17</td> <td style="text-align: center">~</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">DOUT0</td> <td style="text-align: center">18</td> <td style="text-align: center">~</td> <td style="text-align: center"> </td> </tr> <tr> <td style="text-align: center">RESET</td> <td style="text-align: center">19</td> <td style="text-align: center">5 (PA9)</td> <td style="text-align: center">RESET</td> </tr> <tr> <td style="text-align: center">PWDN</td> <td style="text-align: center">20</td> <td style="text-align: center">6 (PC7)</td> <td style="text-align: center">PWDN</td> </tr> <tr> <td style="text-align: center">AFVDD</td> <td style="text-align: center">21</td> <td style="text-align: center">~</td> <td style="text-align: center">~</td> </tr> <tr> <td style="text-align: center">STB</td> <td style="text-align: center">22</td> <td style="text-align: center">~</td> <td style="text-align: center">~</td> </tr> </tbody> </table></div> <p>Note: For 8-bit image sensor data D[7:0] is aligned to ISC_D[4:11]. For 10-bit image sensor data D[9:0] is aligned to ISC_D[2:11]. For 12-bit image sensor data D[11:0] is aligned to ISC_D[0:11].</p> <ul> <li> <p>Take an SD Card formatted with the FAT32 file system and copy the boot.bin binary file from vision/apps/libcamera_usb/firmware/libcamera_usb_sama5d27_wlsom1_ek1.X/at91bootstrap folder. and copy the harmony.bin file generated from the “Building the Application” section.</p> </li> <li> <p>Insert the SD card to J9 of the SAMA5D27-WLSOM1-EK1 board and power up the board by connecting a powered USB cable to J10 USB port on the SSAMA5D27-WLSOM1-EK1 board.</p> </li> <li> <p>optionally you can capture debug messages on serial console such as teraterm or Putty on host machine by connecting an USB to serial cable (FTDI Cable)to J26 port on the SSAMA5D27-WLSOM1-EK1 board.</p> </li> </ul> <h2 id="running-the-demonstration"> <a href="#running-the-demonstration" aria-labelledby="running-the-demonstration" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running the Demonstration </h2> <p>Press the SW3 START_SOM button to power-on the board. The Green LED will turn On and Off indicating the harmony application is running. Inserting USB stick, USB is attached and a file system is mounted. Once file system is mounted, blue LED turns ON &amp; OFF when an image is captured and Green LED is turns ON When a BMP file or JPEG is copied to the USB stick and Application is waiting for SW1 “USER BUTTON” event. Pressing SW1 “USER BUTTON” will capture next image. The blue LED turns ON &amp; OFF when an image is captured and Green LED is turns ON When a BMP or JPEG file is copied to the USB stick and Application is waiting for SW1 “USER BUTTON” event to capture next frame.</p> <p>Note: It will take around a second for the image to be written to the USB stick.</p> <p><img src="/vision/images/sama5d27_wlsom1_ek1_imagesensor_usb.jpg" alt="" /></p> <hr /> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='http://localhost:4000/vision/assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2024 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
